<analysis>

**original_problem_statement**: The user has requested a complete rebuild of the React Native (Expo) frontend for a multi-phase enterprise construction management system. The backend, developed across four phases, is considered feature-complete and its architecture is locked.

The primary objective of the current phase is to:
1.  **Rebuild the entire frontend** with a clean, mobile-first design.
2.  Implement strict **role-based navigation** to separate  and  user experiences.
3.  Create all specified UI screens for modules including Dashboards, Work Orders, Payment Certificates, Budget, Progress, DPR, Reports, and Settings.
4.  Formally define the **API contract** by populating  to ensure the new UI correctly interfaces with the existing backend endpoints without any modifications to the backend logic, financial formulas, or database schema.

**User's preferred language**: English

**what currently exists?**
A comprehensive FastAPI backend has been developed and is considered functionally complete and locked. It includes all schemas, services, and API endpoints for four major phases:
1.  **Core Foundation**: Organisation, Users (with JWT auth), Projects, Auditing.
2.  **Financial Engine**: Work Orders, Payment Certificates, Payments, Retention.
3.  **Operations Engine**: Progress Tracking, Attendance, DPR Generation, Issue/Voice Logs.
4.  **Reporting & Data Layer**: Logic for Dashboard data, Reporting Snapshots, and Offline Sync rules.

On the frontend, the default Expo placeholder screen has been replaced with a proper file-based routing structure using . A blank  file has been created to define API types. No UI screens have been built yet.

**Last working item**:
-   **Last item agent was working**: Starting the Full UI Rebuild + API Contract Lock phase. The agent's very first action was to create the file  to begin defining the data structures for communication between the frontend and the locked backend.
-   **Status**: NOT STARTED
-   **Agent Testing Done**: N
-   **Which testing method agent to use?**: frontend testing agent
-   **User Testing Done**: N

**All Pending/In progress Issue list**:
There are no outstanding bugs. The primary pending work is the large-scale UI implementation task.

**In progress Task List**:
-   **Task 1: Full UI Rebuild & API Contract Lock (P0)**
    -   **Where to resume**: The next step is to populate the  file with all the necessary TypeScript interfaces based on the existing backend API documentation and endpoints. Following that, implement the role-based navigation logic and then begin building the individual screens.
    -   **What will be achieved with this?**: A complete, functional, and role-aware mobile application UI that correctly consumes data from the existing backend, fulfilling the user's latest and most critical request.
    -   **Status**: IN PROGRESS
    -   **Should Test frontend/backend/both after fix?**: frontend
    -   **Blocked on something**: None

**Upcoming and Future Tasks**
The user has provided a detailed list of UI components to be built. All are part of the current UI Rebuild task and are of the highest priority (P0).

**Upcoming Tasks:**
-   **Part 1: Role-Based Navigation (P0)**: Implement two distinct navigation stacks (Admin, Supervisor) with a route guard to prevent unauthorized access.
-   **Part 2: Dashboard Screens (P0)**: Build separate dashboard UIs for Admin (financial overview) and Supervisor (operational overview).
-   **Part 3: Core Module Screens (P0)**: Create UIs for Work Orders, Payment Certificates, Budget, Petty Cash, and CSA.
-   **Part 4: Field Module Screens (P0)**: Create UIs for Attendance, Progress, Voice Log, and Issue Log.
-   **Part 5: DPR Module (P0)**: Build the UI for DPR generation and review.
-   **Part 6: Report Center (P0)**: Build the UI for the reports hub, including list, filters, and export placeholders.
-   **Part 7: OCR UI (P0)**: Create a simple UI for invoice upload and data extraction preview.
-   **Part 8: Settings UI (P0)**: Create the admin-only settings screen.
-   **Part 9: API Contract Freeze (P0)**: Fully populate  with all request/response types.

**Future Tasks:**
-   None. All work is encompassed in the current UI rebuild phase.

**Completed work in this session**
-   **Backend Phase 1**: Core Foundation (Organisation, User, Project, Auth, Audit).
-   **Backend Phase 1 Corrections**: Fixed financial formulas, implemented JWT refresh tokens, and added a hard-delete guard.
-   **Backend Phase 2**: Financial Engine (Work Orders, Payment Certificates, Payments, Retention).
-   **Backend Phase 2 Corrections**: Implemented all missing endpoints and corrected calculation logic.
-   **Backend Phase 3**: Operations Engine (Progress, Attendance, DPR, Issues).
-   **Backend Phase 3 Corrections**: Added Planned Progress, Delay Engine, and a full DPR/Media Retention implementation.
-   **Backend Phase 4**: Defined logic for Reporting, Snapshots, and Offline Sync.
-   **Backend Phase 4 Corrections**: Confirmed snapshot immutability (deep copy) and offline blocks for financial operations.
-   **Frontend Setup**: Established a proper file-based routing structure with , replacing the default Expo screen.

**Earlier issues found/mentioned but not fixed**
-   **Issue 1: MongoDB Transactions Not Enforced**
    -   **Debug checklist**: This is not a bug to fix but an environmental limitation. The agent correctly identified that the Dockerized MongoDB instance lacks a replica set, which is a prerequisite for multi-document ACID transactions. The agent documented the correct transactional code patterns but could not enforce them.
    -   **Why to solve this issue and what will be achieved with this?**: Enforcing true atomic transactions is critical for maintaining financial data integrity in a production system. If this is not addressed (by enabling a replica set in the environment), there is a risk of data inconsistency during complex financial operations.
    -   **Should Test frontend/backend/both after fix**: backend
    -   **Is recurring issue?**: Y

**Known issue recurrence from previous fork**
-   None.

**Code Architecture**


**Key Technical Concepts**
-   **Backend**: FastAPI, Pydantic, Motor (async MongoDB driver), JWT Authentication (Access + Refresh Tokens), Pymongo.
-   **Frontend**: React Native, Expo, Expo Router (file-based routing), TypeScript.
-   **Database**: MongoDB.
-   **Architecture**: Monorepo with distinct  and  services, REST API, Role-Based Access Control (RBAC).

**key DB schema**
-   : Stores organisation data.
-   : User accounts, roles, and permissions.
-   : Stores refresh tokens for JWT auth.
-   : Core project details.
-   : Standardized activity codes.
-   : Budget allocated per project and code.
-   : Atomically calculated financial summaries per project/code.
-   : Immutable log of all state-changing actions.
-   : Financial commitment documents.
-   : Certified work value documents.
-   : Records of payments made against certificates.
-   : Records of retention funds released.
-   : Physical progress tracking.
-   : Scheduled/planned progress baseline.
-   : Supervisor attendance records.
-   , , , , : Operational data entities.

**changes in tech stack**
-   None. The tech stack is locked as per the user's instructions.

**All files of reference**
-   : The main FastAPI server file containing most of the API endpoints.
-   : Contains API endpoints for the Phase 2 financial engine.
-   : The root of the new frontend routing structure.
-   : The file designated for defining all frontend-backend API contracts.
-   All  files in  define the complete backend logic.
-   All  files in  and  contain documentation and summaries of work done in previous phases.

**Areas that need refactoring**:
-   The backend was built in multiple stages, resulting in files like  and . While the user has forbidden backend changes, a future cleanup could involve integrating these routes and services into a more unified structure within  and . This is not part of the current task.

**key api endpoints**
The full API is extensive and documented across several files. Key endpoints to be consumed by the new UI include:
-    (Login)
-    (Refresh Token)
-   Endpoints for CRUD operations on all major entities (Projects, WOs, PCs, etc.), located in  and .
-   The new agent should refer to the Python route files for the exact paths and schemas.

**Critical Info for New Agent**
-   **BACKEND IS LOCKED**: Do not modify any backend files (), financial logic, or database schemas. The current task is **UI ONLY**.
-   **UI REBUILD**: The primary goal is a full frontend rebuild based on the very detailed specification in the last user message (Message 132).
-   **ROLE-BASED NAVIGATION**: A critical requirement is to create separate navigation stacks for 'Admin' and 'Supervisor' roles.
-   **API CONTRACT**: All frontend-backend interactions must be typed in .
-   **MONGO TRANSACTIONS**: Be aware that true atomic transactions for financial operations are **documented in the backend code but not enforced** due to an environment limitation (no replica set). The backend logic is written to use them if they were available.

**documents created in this job**
-   
-   
-   
-   
-   
-   
-   
-   
-   
-    (and other routing files)
-   

**Last 10 User Messages and any pending HUMAN messages**
1.  **Msg 132**: A detailed, multi-part request to rebuild the entire UI from scratch, defining role-based navigation and freezing the API contract. This is the current master plan. (PENDING)
2.  **Msg 121**: Reported that the UI was not rendering and requested a fix for the routing structure. (Completed)
3.  **Msg 119**: Requested final corrections for Phase 4, focusing on snapshot immutability and offline safety. (Completed)
4.  **Msg 116**: Defined the requirements for Phase 4 (Dashboard, Reporting, Offline, UI). (Completed)
5.  **Msg 109**: Requested corrections for Phase 3, including a planned progress table, delay engine, and full DPR implementation. (Completed)
6.  **Msg 102**: Defined the requirements for Phase 3 (Operations & DPR). (Completed)
7.  **Msg 93**: Requested the full implementation of all Phase 2 endpoints and corrected logic. (Completed)
8.  **Msg 82**: Defined the requirements for Phase 2 (Financial Engine). (Completed)
9.  **Msg 55**: Requested critical corrections for Phase 1, including financial formula, atomic transactions, and JWT security. (Completed)
10. **Msg 4**: Provided initial clarifications for Phase 1: use JWT, create a seed script, backend-only, use UTC. (Completed)

**Project Health Check:**
-   **Broken**: The entire user interface is non-existent. It's the main focus of the current task.
-   **Mocked**:
    -   Backend MongoDB transactions are written but not enforced due to the environment lacking a replica set.
    -   The Google Drive upload for the DPR module is a placeholder structure awaiting actual integration.

**3rd Party Integrations**
-   **Google Drive**: Planned for DPR PDF uploads, but not yet implemented. Requires client-side library and authentication.

**Testing status**
-   **Testing agent used after significant changes**: YES (for backend).
-   **Troubleshoot agent used after agent stuck in loop**: NO.
-   **Test files created**: None.
-   **Known regressions**: None.

**Credentials to test flow:**
The backend  script creates an initial admin user:
-   **Email**: 
-   **Password**: 

**What agent forgot to execute**
The agent has been following user instructions closely. The current task is a large, new request to build the UI, so all items listed in that request (Message 132) are pending execution by design. Nothing has been forgotten.

</analysis>
